
package oraclient.view;


import java.awt.Component;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;

import java.io.File;

import java.io.IOException;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import java.util.HashMap;
import java.util.Map;

import javax.swing.JTabbedPane;
import javax.swing.JTable;
import javax.swing.JTextArea;
import javax.swing.JTree;
import javax.swing.text.DefaultEditorKit;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.DefaultTreeModel;
import javax.swing.tree.TreeModel;
import javax.swing.undo.UndoManager;

import oraclient.component.ClientArea;
import oraclient.component.ClientUndoManager;

import oraclient.io.NewFile;

import oraclient.report.Report;

import oraclient.sql.conns.DBConnection;
import oraclient.sql.driver.LoadDriver;


/**
 *
 * @author Price
 */
public class FrontEndForm extends javax.swing.JFrame {

    private ClientArea area;
    private DBConnection oracle;
    private Connection conn;
    private NewFile file;
    private ClientUndoManager undoMgr;
//    private UndoManager undo;
    private Map<String, String> titles = new HashMap<>();

    public FrontEndForm() {
        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    private void initComponents() {//GEN-BEGIN:initComponents

        tabPane = new javax.swing.JTabbedPane();
        outputArea = new javax.swing.JTabbedPane();
        consoleScrollPane = new javax.swing.JScrollPane();
        console = new javax.swing.JTextArea();
        tableScrollPane = new javax.swing.JScrollPane();
        table = new javax.swing.JTable();
        connectionsTabbedPane = new javax.swing.JTabbedPane();
        connectionScrollPane = new javax.swing.JScrollPane();
        connectionsTree = new javax.swing.JTree();
        jToolBar1 = new javax.swing.JToolBar();
        openFileButton = new javax.swing.JButton();
        saveFileButton = new javax.swing.JButton();
        saveAllButton = new javax.swing.JButton();
        sqlRunButton = new javax.swing.JButton();
        dbCommitButton = new javax.swing.JButton();
        dbRollbackButton = new javax.swing.JButton();
        dbUsersComboBox = new javax.swing.JComboBox();
        MainMenu = new javax.swing.JMenuBar();
        fileMenu = new javax.swing.JMenu();
        connectMenuItem = new javax.swing.JMenuItem();
        jSeparator1 = new javax.swing.JPopupMenu.Separator();
        newFileMenuItem = new javax.swing.JMenuItem();
        openFileMenuItem = new javax.swing.JMenuItem();
        jSeparator2 = new javax.swing.JPopupMenu.Separator();
        closeFileMenuItem = new javax.swing.JMenuItem();
        closeAllMenuItem = new javax.swing.JMenuItem();
        jSeparator3 = new javax.swing.JPopupMenu.Separator();
        saveFileMenuItem = new javax.swing.JMenuItem();
        saveAsMenuItem = new javax.swing.JMenuItem();
        saveAllMenuItem = new javax.swing.JMenuItem();
        jSeparator4 = new javax.swing.JPopupMenu.Separator();
        exitMenuItem = new javax.swing.JMenuItem();
        editMenu = new javax.swing.JMenu();
        undoMenuItem = new javax.swing.JMenuItem();
        redoMenuItem = new javax.swing.JMenuItem();
        jSeparator6 = new javax.swing.JPopupMenu.Separator();
        cutMenuItem = new javax.swing.JMenuItem(new DefaultEditorKit.CutAction());
        copyMenuItem = new javax.swing.JMenuItem(new DefaultEditorKit.CopyAction());
        pasteMenuItem = new javax.swing.JMenuItem(new DefaultEditorKit.PasteAction());
        runMenu = new javax.swing.JMenu();
        runScriptMenuItem = new javax.swing.JMenuItem();
        reportMenu = new javax.swing.JMenu();
        getReportMenuItem = new javax.swing.JMenuItem();
        sessionMenu = new javax.swing.JMenu();
        getSessionsMenuItem = new javax.swing.JMenuItem();
        closeSessionsMenuItem = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("DBClient");
        setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        setMinimumSize(new java.awt.Dimension(560, 420));
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        tabPane.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true));

        outputArea.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true));

        console.setColumns(20);
        console.setLineWrap(true);
        console.setRows(5);
        consoleScrollPane.setViewportView(console);

        outputArea.addTab("Консоль", consoleScrollPane);

        table.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tableScrollPane.setViewportView(table);
        if (table.getColumnModel().getColumnCount() > 0) {
            table.getColumnModel().getColumn(0).setHeaderValue("Title 1");
            table.getColumnModel().getColumn(1).setHeaderValue("Title 2");
            table.getColumnModel().getColumn(2).setHeaderValue("Title 3");
            table.getColumnModel().getColumn(3).setHeaderValue("Title 4");
        }

        outputArea.addTab("Таблица", tableScrollPane);

        connectionsTabbedPane.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true));

        javax.swing.tree.DefaultMutableTreeNode treeNode1 = new javax.swing.tree.DefaultMutableTreeNode("Соединения");
        connectionsTree.setModel(new javax.swing.tree.DefaultTreeModel(treeNode1));
        connectionScrollPane.setViewportView(connectionsTree);

        connectionsTabbedPane.addTab("Соединения", connectionScrollPane);

        jToolBar1.setRollover(true);

        openFileButton.setIcon(new javax.swing.ImageIcon("C:\\Oracle\\jdev\\mywork\\OraClient\\OraClient\\resources\\open.png")); // NOI18N
        openFileButton.setToolTipText("Открыть... (Ctrl+O)");
        openFileButton.setFocusable(false);
        openFileButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        openFileButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        openFileButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                openFileButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(openFileButton);

        saveFileButton.setIcon(new javax.swing.ImageIcon("C:\\Oracle\\jdev\\mywork\\OraClient\\OraClient\\resources\\save.png")); // NOI18N
        saveFileButton.setToolTipText("Сохранить (Ctrl+S)");
        saveFileButton.setFocusable(false);
        saveFileButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        saveFileButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        saveFileButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveFileButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(saveFileButton);

        saveAllButton.setIcon(new javax.swing.ImageIcon("C:\\Oracle\\jdev\\mywork\\OraClient\\OraClient\\resources\\save all.png")); // NOI18N
        saveAllButton.setToolTipText("Сохранить все");
        saveAllButton.setFocusable(false);
        saveAllButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        saveAllButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        saveAllButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveAllButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(saveAllButton);

        sqlRunButton.setIcon(new javax.swing.ImageIcon("C:\\Oracle\\jdev\\mywork\\OraClient\\OraClient\\resources\\run.jpeg")); // NOI18N
        sqlRunButton.setToolTipText("Выполнить (F5)");
        sqlRunButton.setFocusable(false);
        sqlRunButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        sqlRunButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        sqlRunButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                sqlRunButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(sqlRunButton);

        dbCommitButton.setIcon(new javax.swing.ImageIcon("C:\\Oracle\\jdev\\mywork\\OraClient\\OraClient\\resources\\commit.png")); // NOI18N
        dbCommitButton.setToolTipText("Commit");
        dbCommitButton.setEnabled(false);
        dbCommitButton.setFocusable(false);
        dbCommitButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        dbCommitButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        dbCommitButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dbCommitButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(dbCommitButton);

        dbRollbackButton.setIcon(new javax.swing.ImageIcon("C:\\Oracle\\jdev\\mywork\\OraClient\\OraClient\\resources\\rollback.png")); // NOI18N
        dbRollbackButton.setToolTipText("Rollback");
        dbRollbackButton.setEnabled(false);
        dbRollbackButton.setFocusable(false);
        dbRollbackButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        dbRollbackButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        dbRollbackButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dbRollbackButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(dbRollbackButton);

        dbUsersComboBox.setEnabled(false);
        dbUsersComboBox.setMaximumSize(new java.awt.Dimension(100, 100));
        dbUsersComboBox.setMinimumSize(new java.awt.Dimension(50, 50));
        jToolBar1.add(dbUsersComboBox);

        fileMenu.setText("Файл");

        connectMenuItem.setText("Соединиться...");
        connectMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                connectMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(connectMenuItem);
        fileMenu.add(jSeparator1);

        newFileMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_N, java.awt.event.InputEvent.CTRL_MASK));
        newFileMenuItem.setText("Новый...");
        newFileMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                newFileMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(newFileMenuItem);

        openFileMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_O, java.awt.event.InputEvent.CTRL_MASK));
        openFileMenuItem.setText("Открыть...");
        openFileMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                openFileMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(openFileMenuItem);
        fileMenu.add(jSeparator2);

        closeFileMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_W, java.awt.event.InputEvent.CTRL_MASK));
        closeFileMenuItem.setText("Закрыть");
        closeFileMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeFileMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(closeFileMenuItem);

        closeAllMenuItem.setText("Закрыть все");
        closeAllMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeAllMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(closeAllMenuItem);
        fileMenu.add(jSeparator3);

        saveFileMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, java.awt.event.InputEvent.CTRL_MASK));
        saveFileMenuItem.setText("Сохранить");
        saveFileMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveFileMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(saveFileMenuItem);

        saveAsMenuItem.setText("Сохранить как...");
        saveAsMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveAsMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(saveAsMenuItem);

        saveAllMenuItem.setText("Сохранить все");
        saveAllMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveAllMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(saveAllMenuItem);
        fileMenu.add(jSeparator4);

        exitMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_F4, java.awt.event.InputEvent.ALT_MASK));
        exitMenuItem.setText("Выход");
        exitMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                exitMenuItemActionPerformed(evt);
            }
        });
        fileMenu.add(exitMenuItem);

        MainMenu.add(fileMenu);

        editMenu.setText("Редактирование");

        undoMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_Z, java.awt.event.InputEvent.CTRL_MASK));
        undoMenuItem.setText("Отменить");
        undoMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                undoMenuItemActionPerformed(evt);
            }
        });
        editMenu.add(undoMenuItem);

        redoMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_Y, java.awt.event.InputEvent.CTRL_MASK));
        redoMenuItem.setText("Вернуть");
        redoMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                redoMenuItemActionPerformed(evt);
            }
        });
        editMenu.add(redoMenuItem);
        editMenu.add(jSeparator6);

        cutMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_X, java.awt.event.InputEvent.CTRL_MASK));
        cutMenuItem.setMnemonic(KeyEvent.VK_T);
        cutMenuItem.setText("Вырезать");
        editMenu.add(cutMenuItem);

        copyMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_C, java.awt.event.InputEvent.CTRL_MASK));
        copyMenuItem.setMnemonic(KeyEvent.VK_C);
        copyMenuItem.setText("Копировать");
        copyMenuItem.setToolTipText("");
        editMenu.add(copyMenuItem);

        pasteMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_V, java.awt.event.InputEvent.CTRL_MASK));
        pasteMenuItem.setMnemonic(KeyEvent.VK_P);
        pasteMenuItem.setText("Вставить");
        editMenu.add(pasteMenuItem);

        MainMenu.add(editMenu);

        runMenu.setText("Выполнить");

        runScriptMenuItem.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_F5, 0));
        runScriptMenuItem.setText("Выполнить сценарий");
        runScriptMenuItem.setEnabled(false);
        runScriptMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                runScriptMenuItemActionPerformed(evt);
            }
        });
        runMenu.add(runScriptMenuItem);

        MainMenu.add(runMenu);

        reportMenu.setText("Отчет");

        getReportMenuItem.setText("Получить отчет");
        getReportMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                getReportMenuItemActionPerformed(evt);
            }
        });
        reportMenu.add(getReportMenuItem);

        MainMenu.add(reportMenu);

        sessionMenu.setText("Сессии");

        getSessionsMenuItem.setText("Список сессий");
        getSessionsMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                getSessionsMenuItemActionPerformed(evt);
            }
        });
        sessionMenu.add(getSessionsMenuItem);

        closeSessionsMenuItem.setText("Завершить все сессии");
        closeSessionsMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeSessionsMenuItemActionPerformed(evt);
            }
        });
        sessionMenu.add(closeSessionsMenuItem);

        MainMenu.add(sessionMenu);

        setJMenuBar(MainMenu);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(connectionsTabbedPane, javax.swing.GroupLayout.DEFAULT_SIZE, 159, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(outputArea, javax.swing.GroupLayout.DEFAULT_SIZE, 535, Short.MAX_VALUE)
                    .addComponent(tabPane)))
            .addComponent(jToolBar1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(jToolBar1, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(tabPane)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(outputArea, javax.swing.GroupLayout.PREFERRED_SIZE, 201, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(connectionsTabbedPane, javax.swing.GroupLayout.DEFAULT_SIZE, 450, Short.MAX_VALUE)))
        );

        pack();
        setLocationRelativeTo(null);
    }//GEN-END:initComponents
    
    private void newFileMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_newFileMenuItemActionPerformed
        FileJDialog dialog = new FileJDialog();
        dialog.setVisible(true);
        dialog.getOkButton().addChangeListener((e) -> {
            String filePath = fileLocation(dialog);
            file = new NewFile(filePath);
            file.putFile(file, filePath);
            file.putSave(file, false);
            initFile(file);
        });
//        String filePath = fileLocation(dialog);
//        file = new NewFile(filePath);
//        file.putFile(file, filePath);
//        file.putSave(file, false);
//        initFile(file);
        runScriptMenuItem.setEnabled(true);
    }//GEN-LAST:event_newFileMenuItemActionPerformed

    private String fileLocation(FileJDialog dialog) {
//        dialog.setVisible(true);
        String filePath = dialog.getFilePath().getText() + dialog.getFileName().getText();
        return filePath;
    }

    private void initFile(File f) {
        area = new ClientArea();
        JTextArea textArea = new JTextArea();
        area.addJTextArea(textArea, f);
        undoMgr = new ClientUndoManager();
        UndoManager undo = new UndoManager();
        undoMgr.putUndoManager(textArea, undo);
        textArea.getDocument().addUndoableEditListener(undo);
        titles.put(f.getName(), f.getAbsolutePath());
        tabPane.addTab(f.getName(), add(area.find(f)));
    }

    public JTextArea getConsole() {
        return console;
    }

    public JTable getTable() {
        return table;
    }

    private void exitMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_exitMenuItemActionPerformed
        formWindowClosing(null);
    }//GEN-LAST:event_exitMenuItemActionPerformed

    private void saveFileMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveFileMenuItemActionPerformed
        int index = tabPane.getSelectedIndex();
        String titleAt = tabPane.getTitleAt(index);
        String tabTitle = find(titles, titleAt);
        if (!file.isSaved(file.find(tabTitle))) {
            file.save(file.find(tabTitle), area.find(file.find(tabTitle)));
        }
    }//GEN-LAST:event_saveFileMenuItemActionPerformed
    
    private String find(Map<String, String> map, String title) {
        for (Map.Entry<String, String> entry : map.entrySet()) {                
            if (title.equals(entry.getKey())) {
                return entry.getValue();
            }
        }
        return null;
    }

    private void closeFileMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeFileMenuItemActionPerformed
        saveFileMenuItemActionPerformed(evt);
        tabPane.remove(tabPane.getSelectedIndex());
    }//GEN-LAST:event_closeFileMenuItemActionPerformed

    private void connectMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_connectMenuItemActionPerformed
        new LoadDriver("oracle.jdbc.OracleDriver");
        oracle = new DBConnection();
        try {
            ConnectionDialog dialog = new ConnectionDialog();
            dialog.setVisible(true);
            String url = dialog.getUrl().getText();
            String user = dialog.getUsrname().getText();
            String password = String.valueOf(dialog.getPwd().getPassword());
            conn = DBConnection.getConnection(url, user, password);
            dbUsersComboBox.addItem(conn.getSchema());
            dbUsersComboBox.setEnabled(true);
            String connectionName = dialog.getConnectionName().getText();
            DefaultMutableTreeNode root = new DefaultMutableTreeNode(connectionName);
            Object connectionsRoot = connectionsTree.getModel().getRoot();
            ((DefaultMutableTreeNode)connectionsRoot).add(root);
            oracle.getDatabaseStructure(connectionsTree, root);
            connectionsTree.setModel(new DefaultTreeModel((DefaultMutableTreeNode)connectionsRoot));
            Statement stmt = oracle.exec(conn, null);
            oracle.getResultSet(stmt, console, table);
            runScriptMenuItem.setEnabled(true);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_connectMenuItemActionPerformed

    private void undoMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_undoMenuItemActionPerformed
        UndoManager undo = undoMgr.find((JTextArea) tabPane.getComponentAt(tabPane.getSelectedIndex()));
        if(undo.canUndo()) {
            undo.undo();
        }
    }//GEN-LAST:event_undoMenuItemActionPerformed

    private void redoMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_redoMenuItemActionPerformed
        UndoManager undo = undoMgr.find((JTextArea) tabPane.getTabComponentAt(tabPane.getSelectedIndex()));
        if (undo.canRedo()) {
            undo.redo();
        }
    }//GEN-LAST:event_redoMenuItemActionPerformed

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        saveAllMenuItemActionPerformed(null);
        if (oracle != null) {
            oracle.close();
        }
        System.exit(0);
    }//GEN-LAST:event_formWindowClosing

    private void runScriptMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_runScriptMenuItemActionPerformed
        //        if(!connected)
        //connectActionPerformed(evt);
        //            oracle.exec(oracle.getConn(), area.getTextAreas().iterator().next());

        //        try (Connection conn = DBConnection.getConnection()) {
        //        Statement stmt = null;
        try {
            Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
            //            stmt.execute(area.getTextAreas().iterator().next().getText());
            dbUsersComboBox.getSelectedItem().toString();
            oracle.getConnections();
            oracle.getResultSet(stmt, console, table);
        } catch (SQLException e) {
        } finally {
            try {
                if (conn != null) {
                    conn.close();
                }
            } catch (SQLException e) {
            }
            //            if(stmt != null) {
            //                try {
            //                    stmt.close();
            //                } catch (SQLException e) {
            //                }
            //            }
        }
    }//GEN-LAST:event_runScriptMenuItemActionPerformed

    private void openFileMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_openFileMenuItemActionPerformed
        OpenFileJDialog dialog = new OpenFileJDialog(this, true);
        dialog.setVisible(true);
        String filePath = dialog.getFilePath().getText();
//        File f = new File(filePath);
        NewFile f = new NewFile(filePath);
        initFile(f);
        if (file == null) {
            file = new NewFile(filePath);
        }
        file.openFile(f, area.find(f));
    }//GEN-LAST:event_openFileMenuItemActionPerformed

    private void closeAllMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeAllMenuItemActionPerformed
        saveAllMenuItemActionPerformed(evt);
        tabPane.removeAll();
        area.getTextAreas().clear();
        file.getFiles().clear();
        file.getSaved().clear();
    }//GEN-LAST:event_closeAllMenuItemActionPerformed

    private void saveAsMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveAsMenuItemActionPerformed
        String title = tabPane.getTitleAt(tabPane.getSelectedIndex());
        String filePath = fileLocation(new FileJDialog());
        file.saveAs(new File(filePath), area.find(file.find(title)));
        tabPane.setTitleAt(tabPane.getSelectedIndex(), filePath);
    }//GEN-LAST:event_saveAsMenuItemActionPerformed

    private void saveAllMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveAllMenuItemActionPerformed
        if (file != null) {
            if (!file.isSavedAll()) {
                file.saveAll(area);
            }
        }
    }//GEN-LAST:event_saveAllMenuItemActionPerformed

    private void getReportMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_getReportMenuItemActionPerformed
        new ReportJDialog(this, true).setVisible(true);
    }//GEN-LAST:event_getReportMenuItemActionPerformed

    private void getSessionsMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_getSessionsMenuItemActionPerformed
        SessionJDialog dialog = new SessionJDialog(this, true);
        dialog.setVisible(true);
        dialog.getTerminateButton().addActionListener((ActionEvent e) -> {
            try {
                conn.close();
            } catch (SQLException f) {
            }
        });
    }//GEN-LAST:event_getSessionsMenuItemActionPerformed

    private void closeSessionsMenuItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeSessionsMenuItemActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_closeSessionsMenuItemActionPerformed

    private void openFileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_openFileButtonActionPerformed
        openFileMenuItemActionPerformed(evt);
    }//GEN-LAST:event_openFileButtonActionPerformed

    private void saveFileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveFileButtonActionPerformed
        saveFileMenuItemActionPerformed(evt);
    }//GEN-LAST:event_saveFileButtonActionPerformed

    private void saveAllButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveAllButtonActionPerformed
        saveAllMenuItemActionPerformed(evt);
    }//GEN-LAST:event_saveAllButtonActionPerformed

    private void sqlRunButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sqlRunButtonActionPerformed
        runScriptMenuItemActionPerformed(evt);
    }//GEN-LAST:event_sqlRunButtonActionPerformed

    private void dbCommitButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dbCommitButtonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_dbCommitButtonActionPerformed

    private void dbRollbackButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dbRollbackButtonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_dbRollbackButtonActionPerformed
  
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(FrontEndForm.class.getName()).log(java.util.logging.Level.SEVERE, null,
                                                                                 ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(FrontEndForm.class.getName()).log(java.util.logging.Level.SEVERE, null,
                                                                                 ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(FrontEndForm.class.getName()).log(java.util.logging.Level.SEVERE, null,
                                                                                 ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(FrontEndForm.class.getName()).log(java.util.logging.Level.SEVERE, null,
                                                                                 ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new FrontEndForm().setVisible(true);
            }
        });
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JMenuBar MainMenu;
    private javax.swing.JMenuItem closeAllMenuItem;
    private javax.swing.JMenuItem closeFileMenuItem;
    private javax.swing.JMenuItem closeSessionsMenuItem;
    private javax.swing.JMenuItem connectMenuItem;
    private javax.swing.JScrollPane connectionScrollPane;
    private javax.swing.JTabbedPane connectionsTabbedPane;
    private javax.swing.JTree connectionsTree;
    private javax.swing.JTextArea console;
    private javax.swing.JScrollPane consoleScrollPane;
    private javax.swing.JMenuItem copyMenuItem;
    private javax.swing.JMenuItem cutMenuItem;
    private javax.swing.JButton dbCommitButton;
    private javax.swing.JButton dbRollbackButton;
    private javax.swing.JComboBox dbUsersComboBox;
    private javax.swing.JMenu editMenu;
    private javax.swing.JMenuItem exitMenuItem;
    private javax.swing.JMenu fileMenu;
    private javax.swing.JMenuItem getReportMenuItem;
    private javax.swing.JMenuItem getSessionsMenuItem;
    private javax.swing.JPopupMenu.Separator jSeparator1;
    private javax.swing.JPopupMenu.Separator jSeparator2;
    private javax.swing.JPopupMenu.Separator jSeparator3;
    private javax.swing.JPopupMenu.Separator jSeparator4;
    private javax.swing.JPopupMenu.Separator jSeparator6;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JMenuItem newFileMenuItem;
    private javax.swing.JButton openFileButton;
    private javax.swing.JMenuItem openFileMenuItem;
    private javax.swing.JTabbedPane outputArea;
    private javax.swing.JMenuItem pasteMenuItem;
    private javax.swing.JMenuItem redoMenuItem;
    private javax.swing.JMenu reportMenu;
    private javax.swing.JMenu runMenu;
    private javax.swing.JMenuItem runScriptMenuItem;
    private javax.swing.JButton saveAllButton;
    private javax.swing.JMenuItem saveAllMenuItem;
    private javax.swing.JMenuItem saveAsMenuItem;
    private javax.swing.JButton saveFileButton;
    private javax.swing.JMenuItem saveFileMenuItem;
    private javax.swing.JMenu sessionMenu;
    private javax.swing.JButton sqlRunButton;
    private javax.swing.JTabbedPane tabPane;
    private javax.swing.JTable table;
    private javax.swing.JScrollPane tableScrollPane;
    private javax.swing.JMenuItem undoMenuItem;
    // End of variables declaration//GEN-END:variables
}
